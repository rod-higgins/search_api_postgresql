parameters:
  search_api_postgresql.embedding_cache:
    table_name: 'search_api_postgresql_embedding_cache'
    default_ttl: 604800  # 7 days
    max_entries: 100000
    cleanup_probability: 0.01
    cleanup_threshold: 0.9
    enable_compression: true

services:
  # Analytics service
  search_api_postgresql.analytics:
    class: Drupal\search_api_postgresql\Service\EmbeddingAnalyticsService
    arguments: 
      - '@database'
      - '@entity_type.manager'
      - '@config.factory'
      - '@logger.channel.search_api_postgresql'

  # Configuration validation service
  search_api_postgresql.configuration_validator:
    class: Drupal\search_api_postgresql\Service\ConfigurationValidationService
    arguments: 
      - '@entity_type.manager'
      - '@key.repository'
      - '@logger.channel.search_api_postgresql'

  # Embedding Cache Services
  search_api_postgresql.embedding_cache.database:
    class: Drupal\search_api_postgresql\Cache\DatabaseEmbeddingCache
    arguments: 
      - '@database'
      - '@logger.channel.search_api_postgresql'
      - '%search_api_postgresql.embedding_cache%'
    tags:
      - { name: 'search_api_postgresql.embedding_cache' }

  search_api_postgresql.embedding_cache.memory:
    class: Drupal\search_api_postgresql\Cache\MemoryEmbeddingCache
    arguments: 
      - '@logger.channel.search_api_postgresql'
      - '%search_api_postgresql.embedding_cache%'
    tags:
      - { name: 'search_api_postgresql.embedding_cache' }

  # Default embedding cache service (alias to database cache)
  search_api_postgresql.embedding_cache:
    alias: search_api_postgresql.embedding_cache.database
    public: true

  # Cache manager service for advanced cache operations
  search_api_postgresql.cache_manager:
    class: Drupal\search_api_postgresql\Cache\EmbeddingCacheManager
    arguments:
      - '@search_api_postgresql.embedding_cache'
      - '@logger.channel.search_api_postgresql'
      - '@config.factory'

  # Queue Services
  search_api_postgresql.embedding_queue_manager:
    class: Drupal\search_api_postgresql\Queue\EmbeddingQueueManager
    arguments:
      - '@queue'
      - '@logger.channel.search_api_postgresql'
      - '@config.factory'
    public: true
    tags:
      - { name: 'search_api_postgresql.queue_manager' }

  # Queue-aware embedding service wrapper
  search_api_postgresql.queued_embedding_service:
    class: Drupal\search_api_postgresql\Service\QueuedEmbeddingService
    arguments:
      - '@search_api_postgresql.embedding_queue_manager'
      - '@logger.channel.search_api_postgresql'
      - '@config.factory'
    tags:
      - { name: 'search_api_postgresql.embedding_service' }

  # Circuit breaker service
  search_api_postgresql.circuit_breaker:
    class: Drupal\search_api_postgresql\Service\CircuitBreakerService
    arguments:
      - '@state'
      - '@logger.channel.search_api_postgresql'
      - '@config.factory'

  # Error recovery service
  search_api_postgresql.error_recovery:
    class: Drupal\search_api_postgresql\Service\ErrorRecoveryService
    arguments:
      - '@search_api_postgresql.circuit_breaker'
      - '@queue'
      - '@logger.channel.search_api_postgresql'
      - '@config.factory'

  # Error classification service
  search_api_postgresql.error_classification:
    class: Drupal\search_api_postgresql\Service\ErrorClassificationService
    arguments:
      - '@logger.channel.search_api_postgresql'

  # Degradation message service
  search_api_postgresql.degradation_messages:
    class: Drupal\search_api_postgresql\Service\EnhancedDegradationMessageService
    arguments:
      - '@string_translation'
      - '@config.factory'

  # Logger channel
  logger.channel.search_api_postgresql:
    parent: logger.channel_base
    arguments: ['search_api_postgresql']

  # drush commands
  search_api_postgresql.commands:
    class: Drupal\search_api_postgresql\Commands\SearchApiPostgreSQLCommands
    arguments:
      - '@entity_type.manager'
      - '@search_api_postgresql.analytics'
      - '@search_api_postgresql.configuration_validator'
      - '@search_api_postgresql.cache_manager'
      - '@search_api_postgresql.embedding_queue_manager'
    tags:
      - { name: drush.command }