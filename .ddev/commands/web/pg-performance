#!/bin/bash

## Description: PostgreSQL performance and database information
## Usage: pg-performance
## Example: "ddev pg-performance"

echo "=== PostgreSQL Performance Check ==="
psql -h db -U db -d db -c "
SELECT
  'Database Size' as metric,
  pg_size_pretty(pg_database_size('db')) as value
UNION ALL
SELECT
  'Active Connections',
  count(*)::text
FROM pg_stat_activity
WHERE state = 'active'
UNION ALL
SELECT
  'Cache Hit Ratio',
  round(100.0 * sum(blks_hit) / (sum(blks_hit) + sum(blks_read)), 2)::text || '%'
FROM pg_stat_database
WHERE datname = 'db';
"